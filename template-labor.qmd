---
title: "Italy"
output-file: "Italy"
iso: "ITA"
execute:
  echo: false
  warning: false
format:
  snapshot-labor-typst: default
---

```{r}
#| include: false
devtools::load_all(".")
knitr::opts_chunk$set(dev = "svglite")
code <- rmarkdown::metadata$iso
name <- namer(code)
i <- 1
j <- 0
```

```{=typst}
#caption[`r caption_immig(code)`]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.25
#| message: false

snap_plot("immorig", code, basesize = basesize, font = font) |>
  plot_label(i, span = 1, h = .15 / 2.25)
i <- i + 1
```

```{=typst}
#caption[
`r caption_immpyr(code)`
#colbreak()
`r caption_immdep(code)`
]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.75
#| message: false

cowplot::plot_grid(
  snap_plot("immpyr", code, basesize = basesize, font = font) |>
    plot_label(i, h = .15 / 2.75),
  snap_plot("immdep", code, basesize = basesize, font = font) |>
    plot_label(i + 1, h = .15 / 2.75)
)
i <- i + 2
```

```{=typst}
///////////////////////////////////////////////// PAGE 2 ⬇️
#pagebreak()
```

```{=typst}
#caption[
`r caption_emp(code)`
#colbreak()
`r caption_empeduc(code)`
]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.4
#| message: false

cowplot::plot_grid(
  snap_plot("emp", code, basesize = basesize, font = font) |>
    plot_label(i, h = .15 / 2.4),
  snap_plot("empeduc", code, basesize = basesize, font = font) |>
    plot_label(i + 1, h = .15 / 2.4)
)
i <- i + 2
```

```{=typst}
#caption[
`r caption_unemrate(code)`
#colbreak()
`r caption_unemeduc(code)`
]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.4
#| message: false

cowplot::plot_grid(
  snap_plot("unemrate", code, basesize = basesize, font = font) |>
    plot_label(i, h = .15 / 2.4),
  snap_plot("unemeduc", code, basesize = basesize, font = font) |>
    plot_label(i + 1, h = .15 / 2.4)
)
i <- i + 2
```

```{=typst}
#caption[
`r caption_earnings(code)`
#colbreak()
`r caption_hours(code)`
]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.4
#| message: false

cowplot::plot_grid(
  snap_plot("earnings", code, basesize = basesize, font = font) |>
    plot_label(i, h = .15 / 2.4),
  snap_plot("hours", code, basesize = basesize, font = font) |>
    plot_label(i + 1, h = .15 / 2.4)
)
i <- i + 2
```

```{=typst}
///////////////////////////////////////////////// PAGE 3 ⬇️
#pagebreak()
```

```{=typst}
`r caption_empsector(code)`
```

```{r}
#| fig-width: 6.7
#| fig-height: 3.0
#| message: false

snap_plot("empsector", code, basesize = basesize, font = font) |>
  plot_label(i, span = 1, h = .15 / 3.0)

i <- i + 1
```

```{=typst}
#caption[
`r caption_gva(code)`
#colbreak()
`r caption_exports(code)`
]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.35
#| message: false

cowplot::plot_grid(
  snap_plot("gva", code, basesize = basesize, font = font) |>
    plot_label(i, h = .15 / 2.35),
  snap_plot("exports", code, basesize = basesize, font = font) |>
    plot_label(i + 1, h = .15 / 2.35)
)
i <- i + 2
```

```{=typst}
#caption[
`r caption_empoccup(code)`
#colbreak()
`r caption_unemoccup(code)`
]
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.35
#| message: false

cowplot::plot_grid(
  snap_plot("empoccup", code, basesize = basesize, font = font) |>
    plot_label(i, h = .15 / 2.35),
  snap_plot("unemoccup", code, basesize = basesize, font = font) |>
    plot_label(i + 1, h = .15 / 2.35)
)
i <- i + 2
```

```{=typst}
///////////////////////////////////////////////// PAGE 4 ⬇️
#pagebreak()
```

```{=typst}
`r caption_empskill(code)`
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.0
#| message: false

snap_plot("empskill", code, basesize = basesize, font = font) |>
  plot_label(i, span = 1, h = .15 / 2.0)

i <- i + 1
```

```{r}
#| fig-width: 6.7
#| fig-height: .25
#| message: false

year <- snap_data("empcountry", code)$range[1]
title <- str_glue(
  "Sectoral employment in {name}, ",
  "in migrant origin countries, and in countries worldwide, {year}"
)
if (is.null(year)) {
  title <- str_glue(
    "Sectoral employment in {name}, ",
    "in migrant origin countries, and in countries worldwide"
  )
}

plot_title <- ggplot() + 
  ggtitle(title) + 
  apply_theme("bar-vertical", basesize = basesize, font = font)

plot_title |> plot_label(i, span = 1, h = .15 / .25)
```

```{=typst}
`r caption_empcountry(code, row = 1)`
```

```{r}
#| fig-width: 6.7
#| fig-height: 1.75
#| message: false

snap_plot("empcountry", code, basesize = basesize, font = font, row = 1)
```

```{=typst}
`r caption_empcountry(code, row = 2)`
```

```{r}
#| fig-width: 6.7
#| fig-height: 2.0
#| message: false

snap_plot("empcountry", code, basesize = basesize, font = font, row = 2)
```
